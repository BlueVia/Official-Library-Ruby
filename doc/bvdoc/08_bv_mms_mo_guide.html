<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>File: 08_bv_mms_mo_guide [RDoc Documentation]</title>

  <link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet" />

  <script src="../js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file">
  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../Gemfile.html">Gemfile</a></li>
        
          <li class="file"><a href="../Rakefile.html">Rakefile</a></li>
        
          <li class="file"><a href="../UserGuide.html">UserGuide</a></li>
        
          <li class="file"><a href="../bvdoc/00_bv_oauth_guide.html">00_bv_oauth_guide</a></li>
        
          <li class="file"><a href="../bvdoc/01_bv_advertising_guide.html">01_bv_advertising_guide</a></li>
        
          <li class="file"><a href="../bvdoc/02_bv_location_guide.html">02_bv_location_guide</a></li>
        
          <li class="file"><a href="../bvdoc/03_bv_directory_guide.html">03_bv_directory_guide</a></li>
        
          <li class="file"><a href="../bvdoc/04_bv_payment_guide.html">04_bv_payment_guide</a></li>
        
          <li class="file"><a href="../bvdoc/05_bv_sms_mt_guide.html">05_bv_sms_mt_guide</a></li>
        
          <li class="file"><a href="../bvdoc/06_bv_mms_mt_guide.html">06_bv_mms_mt_guide</a></li>
        
          <li class="file"><a href="../bvdoc/07_bv_sms_mo_guide.html">07_bv_sms_mo_guide</a></li>
        
          <li class="file"><a href="../bvdoc/08_bv_mms_mo_guide.html">08_bv_mms_mo_guide</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../Bluevia.html">Bluevia</a></li>
        
          <li><a href="../Bluevia/BVAdvertising.html">Bluevia::BVAdvertising</a></li>
        
          <li><a href="../Bluevia/BVAdvertisingClient.html">Bluevia::BVAdvertisingClient</a></li>
        
          <li><a href="../Bluevia/BVBaseClient.html">Bluevia::BVBaseClient</a></li>
        
          <li><a href="../Bluevia/BVDirectory.html">Bluevia::BVDirectory</a></li>
        
          <li><a href="../Bluevia/BVDirectoryClient.html">Bluevia::BVDirectoryClient</a></li>
        
          <li><a href="../Bluevia/BVLocation.html">Bluevia::BVLocation</a></li>
        
          <li><a href="../Bluevia/BVLocationClient.html">Bluevia::BVLocationClient</a></li>
        
          <li><a href="../Bluevia/BVMoClient.html">Bluevia::BVMoClient</a></li>
        
          <li><a href="../Bluevia/BVMoMms.html">Bluevia::BVMoMms</a></li>
        
          <li><a href="../Bluevia/BVMoMmsClient.html">Bluevia::BVMoMmsClient</a></li>
        
          <li><a href="../Bluevia/BVMoSms.html">Bluevia::BVMoSms</a></li>
        
          <li><a href="../Bluevia/BVMoSmsClient.html">Bluevia::BVMoSmsClient</a></li>
        
          <li><a href="../Bluevia/BVMode.html">Bluevia::BVMode</a></li>
        
          <li><a href="../Bluevia/BVMtClient.html">Bluevia::BVMtClient</a></li>
        
          <li><a href="../Bluevia/BVMtMms.html">Bluevia::BVMtMms</a></li>
        
          <li><a href="../Bluevia/BVMtMmsClient.html">Bluevia::BVMtMmsClient</a></li>
        
          <li><a href="../Bluevia/BVMtSms.html">Bluevia::BVMtSms</a></li>
        
          <li><a href="../Bluevia/BVMtSmsClient.html">Bluevia::BVMtSmsClient</a></li>
        
          <li><a href="../Bluevia/BVOauth.html">Bluevia::BVOauth</a></li>
        
          <li><a href="../Bluevia/BVOauthClient.html">Bluevia::BVOauthClient</a></li>
        
          <li><a href="../Bluevia/BVPayment.html">Bluevia::BVPayment</a></li>
        
          <li><a href="../Bluevia/BlueviaError.html">Bluevia::BlueviaError</a></li>
        
          <li><a href="../Bluevia/ConnectionError.html">Bluevia::ConnectionError</a></li>
        
          <li><a href="../Bluevia/Errors.html">Bluevia::Errors</a></li>
        
          <li><a href="../Bluevia/IConnector.html">Bluevia::IConnector</a></li>
        
          <li><a href="../Bluevia/IConnector/BVHttpOAuthConnector.html">Bluevia::IConnector::BVHttpOAuthConnector</a></li>
        
          <li><a href="../Bluevia/IParser.html">Bluevia::IParser</a></li>
        
          <li><a href="../Bluevia/IParser/JsonParser.html">Bluevia::IParser::JsonParser</a></li>
        
          <li><a href="../Bluevia/IParser/JsonRpcParser.html">Bluevia::IParser::JsonRpcParser</a></li>
        
          <li><a href="../Bluevia/IParser/MultipartParser.html">Bluevia::IParser::MultipartParser</a></li>
        
          <li><a href="../Bluevia/IParser/XmlParser.html">Bluevia::IParser::XmlParser</a></li>
        
          <li><a href="../Bluevia/ISerializer.html">Bluevia::ISerializer</a></li>
        
          <li><a href="../Bluevia/ISerializer/JsonRpcSerializer.html">Bluevia::ISerializer::JsonRpcSerializer</a></li>
        
          <li><a href="../Bluevia/ISerializer/JsonSerializer.html">Bluevia::ISerializer::JsonSerializer</a></li>
        
          <li><a href="../Bluevia/ISerializer/MultipartSerializer.html">Bluevia::ISerializer::MultipartSerializer</a></li>
        
          <li><a href="../Bluevia/ISerializer/UrlEncodedSerializer.html">Bluevia::ISerializer::UrlEncodedSerializer</a></li>
        
          <li><a href="../Bluevia/Schemas.html">Bluevia::Schemas</a></li>
        
          <li><a href="../Bluevia/Schemas/AccessFields.html">Bluevia::Schemas::AccessFields</a></li>
        
          <li><a href="../Bluevia/Schemas/AccessInfo.html">Bluevia::Schemas::AccessInfo</a></li>
        
          <li><a href="../Bluevia/Schemas/Attachment.html">Bluevia::Schemas::Attachment</a></li>
        
          <li><a href="../Bluevia/Schemas/AttachmentInfo.html">Bluevia::Schemas::AttachmentInfo</a></li>
        
          <li><a href="../Bluevia/Schemas/BVResponse.html">Bluevia::Schemas::BVResponse</a></li>
        
          <li><a href="../Bluevia/Schemas/CreativeElement.html">Bluevia::Schemas::CreativeElement</a></li>
        
          <li><a href="../Bluevia/Schemas/DeliveryInfo.html">Bluevia::Schemas::DeliveryInfo</a></li>
        
          <li><a href="../Bluevia/Schemas/DirectoryDataSets.html">Bluevia::Schemas::DirectoryDataSets</a></li>
        
          <li><a href="../Bluevia/Schemas/LocationInfo.html">Bluevia::Schemas::LocationInfo</a></li>
        
          <li><a href="../Bluevia/Schemas/MimeContent.html">Bluevia::Schemas::MimeContent</a></li>
        
          <li><a href="../Bluevia/Schemas/MmsMessage.html">Bluevia::Schemas::MmsMessage</a></li>
        
          <li><a href="../Bluevia/Schemas/MmsMessageInfo.html">Bluevia::Schemas::MmsMessageInfo</a></li>
        
          <li><a href="../Bluevia/Schemas/PaymentResult.html">Bluevia::Schemas::PaymentResult</a></li>
        
          <li><a href="../Bluevia/Schemas/PaymentStatus.html">Bluevia::Schemas::PaymentStatus</a></li>
        
          <li><a href="../Bluevia/Schemas/PersonalFields.html">Bluevia::Schemas::PersonalFields</a></li>
        
          <li><a href="../Bluevia/Schemas/PersonalInfo.html">Bluevia::Schemas::PersonalInfo</a></li>
        
          <li><a href="../Bluevia/Schemas/Profile.html">Bluevia::Schemas::Profile</a></li>
        
          <li><a href="../Bluevia/Schemas/ProfileFields.html">Bluevia::Schemas::ProfileFields</a></li>
        
          <li><a href="../Bluevia/Schemas/ProtectionPolicy.html">Bluevia::Schemas::ProtectionPolicy</a></li>
        
          <li><a href="../Bluevia/Schemas/RequestToken.html">Bluevia::Schemas::RequestToken</a></li>
        
          <li><a href="../Bluevia/Schemas/SimpleAdResponse.html">Bluevia::Schemas::SimpleAdResponse</a></li>
        
          <li><a href="../Bluevia/Schemas/SmsMessage.html">Bluevia::Schemas::SmsMessage</a></li>
        
          <li><a href="../Bluevia/Schemas/TerminalFields.html">Bluevia::Schemas::TerminalFields</a></li>
        
          <li><a href="../Bluevia/Schemas/TerminalInfo.html">Bluevia::Schemas::TerminalInfo</a></li>
        
          <li><a href="../Bluevia/Schemas/TypeId.html">Bluevia::Schemas::TypeId</a></li>
        
          <li><a href="../Bluevia/Schemas/UserIdType.html">Bluevia::Schemas::UserIdType</a></li>
        
          <li><a href="../Bluevia/Schemas/UserInfo.html">Bluevia::Schemas::UserInfo</a></li>
        
          <li><a href="../Bluevia/Utils.html">Bluevia::Utils</a></li>
        
          <li><a href="../OAuth.html">OAuth</a></li>
        
          <li><a href="../OAuth/Client.html">OAuth::Client</a></li>
        
          <li><a href="../OAuth/Client/Helper.html">OAuth::Client::Helper</a></li>
        
          <li><a href="../Rack.html">Rack</a></li>
        
          <li><a href="../Rack/Multipart.html">Rack::Multipart</a></li>
        
          <li><a href="../Rack/Multipart/Parser.html">Rack::Multipart::Parser</a></li>
        
          <li><a href="../BlueviaLogger.html">BlueviaLogger</a></li>
        
          <li><a href="../DemoAdvertising.html">DemoAdvertising</a></li>
        
          <li><a href="../DemoDirectory.html">DemoDirectory</a></li>
        
          <li><a href="../DemoLocation.html">DemoLocation</a></li>
        
          <li><a href="../DemoMmsMo.html">DemoMmsMo</a></li>
        
          <li><a href="../DemoMmsMt.html">DemoMmsMt</a></li>
        
          <li><a href="../DemoOauth.html">DemoOauth</a></li>
        
          <li><a href="../DemoPayment.html">DemoPayment</a></li>
        
          <li><a href="../DemoSmsMo.html">DemoSmsMo</a></li>
        
          <li><a href="../DemoSmsMt.html">DemoSmsMt</a></li>
        
          <li><a href="../Hash.html">Hash</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    
<p><a href="../Bluevia.html">Bluevia</a> MMS Mobile Originated Client Guide</p>

<p>Introduction</p>

<pre>The Bluevia MMS API is a set of functions which allows users to receive 
MMS messages sent from a mobile phone. This guide represents a practical 
introduction to developing applications in which the user wants to provide 
the Bluevia MMS functionality.</pre>

<p>MMS MO client basics</p>

<pre>A MMS client represents the client side in a classic client-server schema. 
This object wraps up the underlying REST client side functionality needed 
to perform requests against a REST server. 

Any Bluevia client performs requests and receives responses in a secure mode. 
Clients are authorized following the OAuth protocol. This security protocol 
enables users to grant third-party access to their resources without sharing 
their passwords. So clients store the authorization data -called security 
credentials- to grant access to the server. 

Following sections describe what security credentials we are talking about.</pre>

<p>Creating a MMS MO client: BVMoMms class</p>

<pre>First step for using MMS MO client is to create a BVMoMms object. This object 
can have three different working modes: 

- LIVE or BVMODE::LIVE Your application uses real network, which means that you 
  will be able to send real transactions to real Movistar, O2 and Vivo customers 
  in the applicable country.
- TEST or BVMODE::TEST Behave exactly likes Live mode, but API calls are free 
  of chargue, using a credits system. You are required to have a Movistar, O2 
  or Vivo mobile number to get this monthly credits.
- SANDBOX or BVMODE::SANDBOX Sandbox environment offers you the exact same 
  experience as Live environment except that no traffic is generated on live network.</pre>

<p>MMS MO client features: security credentials</p>

<pre>Bluevia uses OAuth as its authentication mechanism which enables websites and 
applications to access the Bluevia API's without end users disclosing their 
personal credentials.

In order to grant access to the server any client has to be created passing the
security credential as parameter in its constructor. These security credentials
are managed internally and added as a HTTP header in every request sent to the server.

Bluevia MMS MO API uses OAuth-2-legged since user's authorization is not required 
to received MMSs. Then, it is not neccessary for the user to pass through the 
OAuth process and there is no need of an access token. Mandatory Oauth security 
credentials for 2-legged mode are:

- Consumer key: The string identifying the application- you obtained when you 
  registered your application within the provisioning portal.
- Consumer Secret: A secret -a string- used by the consumer to establish 
  ownership of the consumer key.</pre>

<p>MMS MO client features: code example</p>

<pre>Find below an example on how to create an BVMoMms Client taking into account 
all information previously given.

# two-legged BVMoMms client
@bc = BVMoMms.new(BVMode::LIVE, &quot;[CONSUMER_KEY]&quot;,&quot;[CONSUMER_SECRET]&quot;)</pre>

<p>Receiving MMS messages: Polling to receive messages</p>

<pre>Your application can receive MMS from users sent to Bluevia shortcodes 
including your application keyword. The parameter 'registration_id' corresponds 
to the shortcode of the country whose messages are being retrieved. Depending 
on the second parameter, answer would include attachment id and content-type 
(if true) or not (if false). The function signature is:

   def get_all_messages(registration_id, use_attachment_i = false)

It returns an array full of Bluevia::Schemas::MmsMessageInfo objects.

This MmsMessageInfo object contains the information of the sent MMS, but the 
attachments. In order to retreive MMS attachments you have to use next function:

   def get_message(registration_id, message_id) 

'messageId' can be obtained in the MmsMessageInfo object returned by the previous 
function. Resultant MmsMessage object contains the info of the Mms and a list of 
MimeContent objects representing every attachments.

Using the getAttachment function you will receive the MimeContent object 
corresponding to he attachment identifier:

   def get_attachment(registration_id, message_id, attachment_id)</pre>

<p>Receiving MMS messages: Message notification</p>

<pre>Your application can create a subscription to receive MMS sent to your application. 
You can also unsubscribe the notification for this request.

To receive notifications about MMS sent to your applications you must provide an 
endpoint whit the URI where notifications must be sent and the criteria word.

   info = @bc.start_notification(mms_special_number , endpoint, criteria, nil)

Note that BlueVia only accepts HTTPS endpoints and the server certificate must be 
provided during the process of requesting the API key.

You must also provide the list with the destination addresses and shortcode numbers.

Then you can provide the criteria element containing the keyword you chose for your 
application when you requested the API key (keywords are case-insensitive)

Now, you must include your endpoint and correlator in send method and you will 
get notified in your endpoint for MMS sent

   info = @bc.send(destination, subject, message, attachment, endpoint, correlator)

If you want to unsubscribe and stop reveiving notifications you should simply do:

   @bc.stop_notification(info)</pre>

<p><a href="../Bluevia.html">Bluevia</a> MMS MO PI: code example</p>

<pre>begin

  # 1. Create the client (you have to choose the mode and include the OAuth authorization values. No access token is needed)
  @bc = BVMoMMS.new(BVMode::LIVE, &quot;[CONSUMER_KEY]&quot;,&quot;[CONSUMER_SECRET]&quot;)

  # 2. Retrieve sent MMSs:
  messages = @bc.get_all_messages(&quot;546780&quot;, true)

  # 3. For each message...
  messages.each{|obj|

  # ...get message_ids... 
  mess_id &lt;&lt; obj.message_id

  # ...in order to get every message separately.
  message = @mo.get_message(&quot;546780&quot;, obj.message_id)

  # 4. Get all attachments of one message...
  attachmentsmes = message.attachments

  # ... and save them in a file
  attachmentsmes.each_index{|file_att|
    f_at= File.new(&quot;attachment#{file_att}&quot;, &quot;w&quot;)
    f_at.write(attachmentsmes[file_att].content)
    f_at.close
    } 

  # 5. Or get each attachment separately...
  obj[&quot;attachmentURL&quot;].each{|attach|
    url = attach[&quot;href&quot;]
    content_type = attach[&quot;contentType&quot;]
            # attachment is a MimeContent object
    attachment=@service.get_attachment(&quot;546780&quot;, obj.message_id, url)
    puts attachment.name
    # You can also save the attachment.content in a file as show before!
    }
    }
rescue BlueviaError =&gt; e
  cod = e.code
  mess = e.message
end</pre>

  </div>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>
</body>
</html>

